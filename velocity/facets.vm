#**
 *  Faceted navigation sidebar - CORRIGIDO
 *#

#set($labelsMap = {
    'grupo_processo_s': 'Grupo Processo',
    'tipo_processo_s': 'Tipo Processo',
    'subtipo_processo_s': 'Subtipo Processo',
    'tipo_documento_s': 'Tipo Documento',
    'situacao_s': 'Situação',
    
    'unidade_origem_s': 'Unidade Origem',
    'equipe_origem_s': 'Equipe Origem',
    'nome_unidade_atual_s': 'Unidade Atual',
    'nome_equipe_atual_s': 'Equipe Atual',
    
    'tributo_act_s': 'Tributo ACT',
    'assuntos_objetos_s': 'Assuntos/Objetos',
    
    'result_questdrj_nivel1_s': 'Resultado DRJ Nível 1',
    'result_questdrj_nivel2_s': 'Resultado DRJ Nível 2',
    'nome_relator_drj_s': 'Nome Relator DRJ',
    
    'arquivo_indexado_s': 'Arquivo Indexado',
    'indicador_pesquisavel_s': 'Pesquisável (OCR)'
})

## Verificar se existem facetas com valores
#set($hasFacets = false)
#if($response.facet_counts && $response.facet_counts.facet_fields)
    #foreach($field in $response.facet_counts.facet_fields)
        #if($field.value && $field.value.size() > 0)
            #set($hasFacets = true)
            #break
        #end
    #end
#end

## Só renderizar se houver facetas
#if($hasFacets)
    #foreach($field in $response.facet_counts.facet_fields)
        #set($fieldName = $field.key)
        #set($facetValues = $field.value)
        
        ## Verificar se tem valores
        #if($facetValues && $facetValues.size() > 0)
            <div class="facetGroup open">
                <button class="facetTitle" title="#if($labelsMap.get($fieldName))$labelsMap.get($fieldName)#else$fieldName#end">
                    <span>#if($labelsMap.get($fieldName))$labelsMap.get($fieldName)#else$fieldName#end</span>
                    <img class="iconColor facetChevron" src="${assetsPath}/img/icons/chevron-down-solid-full.svg" alt="">
                </button>
                <ul class="facetList">
                    ## Iterar valores (formato: [nome1, count1, nome2, count2, ...])
                    #set($i = 0)
                    #foreach($item in $facetValues)
                        #if($math.mod($i, 2) == 0)
                            ## É o nome da faceta
                            #set($facetName = $item)
                        #else
                            ## É o count
                            #set($facetCount = $item)
                            #if($facetCount > 0)
                                <li class="facetItem">
                                    <button class="facetButton" onclick="window.location.href='#url_for_facet_filter($fieldName $facetName)'" title="$!esc.html($facetName)">
                                        <span class="facetLabel">#if($facetName)$esc.html($display.truncate($facetName, 30))#else<em>Não informado</em>#end</span>
                                        <span class="facetNumber">$number.format('#,##0', $facetCount)</span>
                                    </button>
                                </li>
                            #end
                        #end
                        #set($i = $i + 1)
                    #end
                </ul>
            </div>
        #end
    #end
#end

## Facet queries (se houver)
#if($response.facet_counts.facet_queries)
    #set($facetQueries = $response.facet_counts.facet_queries)
    #if($facetQueries.size() > 0)
        <div class="facetGroup">
            <button class="facetTitle">
                <span>Filtros Rápidos</span>
                <img class="iconColor facetChevron" src="${assetsPath}/img/icons/chevron-down-solid-full.svg" alt="">
            </button>
            <ul class="facetList">
                #foreach($fq in $facetQueries.entrySet())
                    #if($fq.value > 0)
                        <li class="facetItem">
                            <button class="facetButton" onclick="window.location.href='#url_for_home#lens&fq=$esc.url($fq.key)'">
                                <span class="facetLabel">$fq.key</span>
                                <span class="facetNumber">$number.format('#,##0', $fq.value)</span>
                            </button>
                        </li>
                    #end
                #end
            </ul>
        </div>
    #end
#end