#**
 *  Main entry point - eProcesso Buscador
 *  Modern interface with full Solr integration - CORRIGIDO
 *#

## ========================================
## ASSETS PATH DINÃ‚MICO
## ========================================
## Path dos assets
#set($assetsPath = "#assets_root")

## Parse query parameters
#parse("query.vm")

#set($hasResults = $response.results && $response.results.size() > 0)
#set($hasQuery = $params.get('q') && $params.get('q') != '' && $params.get('q') != '*:*')

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    #parse("head.vm")
</head>
<body class="#if(!$hasResults)empty-state#end">
    <!-- HEADER -->
    <header id="mainHeader">
        <div id="mainHeaderLeft">
            <button id="sidebarBtn" class="btn-icon" aria-label="Abrir menu">
                <img class="iconColor" src="${assetsPath}/img/icons/bars-solid-full.svg" alt="">
            </button>
            <img id="logoMain" src="${assetsPath}/img/logos/logo-eprocesso-buscador.svg" alt="eProcesso Buscador">
            <img id="logoShort" src="${assetsPath}/img/logos/logo-eprocesso-buscador-short.svg" alt="eProcesso Buscador">
        </div>
        
        #if($hasResults)
        <search id="headerSearch">
            <form class="searchForm" action="#url_for_home" method="GET">
                <div class="searchInputWraper #if($params.get('q') && $params.get('q') != '*:*')hasValue#end">
                    <img class="searchIcon iconColor" src="${assetsPath}/img/icons/magnifying-glass-solid-full.svg" alt="">
                    <input class="searchInput" type="text" name="q" id="headerSearchInput" placeholder="Digite para buscar..." value="#if($params.get('q') && $params.get('q') != '*:*')$!esc.html($params.get('q'))#end">
                    <button class="searchCloseBtn" type="button" aria-label="Limpar busca">
                        <img class="iconColor" src="${assetsPath}/img/icons/xmark-solid-full.svg" alt="">
                    </button>
                    <kbd class="searchKBD">Ctrl+K</kbd>
                </div>
                <button class="searchBtn" type="submit">Buscar</button>
                <button type="button" class="filterBtn">
                    <span class="filterBtnIcon">
                        <img class="iconColor" src="${assetsPath}/img/icons/filter-solid-full.svg" alt="">
                    </span>
                    <span class="filterBtnText">Filtrar</span>
                    <span class="filtersUsedNumbers" id="headerFilterCount"></span>
                </button>
                #foreach($fq in $request.params.getParams('fq'))
                    <input type="hidden" name="fq" value="$esc.html($fq)"/>
                #end
            </form>
        </search>
        #end
        
        <div id="logosParceiros">
            <img src="${assetsPath}/img/logos/logo-parceiro-receita.svg" alt="Receita Federal">
            <img src="${assetsPath}/img/logos/logo-parceiro-pgfn.svg" alt="PGFN">
            <img src="${assetsPath}/img/logos/logo-parceiro-carf.svg" alt="CARF">
        </div>
        
        <div id="accessibilityDropdown" class="dropdown">
            <button id="accessibilityBtn" class="btn-icon" aria-label="Acessibilidade">
                <img class="iconColor" src="${assetsPath}/img/icons/universal-access-solid-full.svg" alt="">
            </button>
            <ul id="accessibilityMenu" class="dropdown-menu dropdown-menu-bottom dropdown-menu-right">
                <li><button class="dropdown-item" value="theme">ğŸŒ™ Tema escuro</button></li>
                <li><button class="dropdown-item" value="contrast">â— Alto contraste</button></li>
                <li><button class="dropdown-item" value="fontUp">A+ Aumentar fonte</button></li>
                <li><button class="dropdown-item" value="fontDown">A- Diminuir fonte</button></li>
                <li class="dropdown-divider"></li>
                <li><button class="dropdown-item" value="reset">ğŸ”„ Restaurar padrÃ£o</button></li>
            </ul>
        </div>
    </header>

    <!-- EMPTY PAGE -->
    <main id="pageEmpty">
        <div class="empty-component">
            <div class="empty-icon">
                <img src="${assetsPath}/img/icons/magnifying-glass-solid-full.svg" alt="">
            </div>
            <div class="empty-text">
                <h1 class="empty-title">Busque processos administrativos</h1>
                <p class="empty-description">Digite um termo para pesquisar processos da Receita Federal, PGFN e CARF.</p>
            </div>
            <search class="empty-search">
                <form class="searchForm" action="#url_for_home" method="GET">
                    <div id="empty-search-container">
                        <button type="button" id="ajudaBtnEmpty" class="btn-icon" aria-label="Ajuda">
                            <img class="iconColor" src="${assetsPath}/img/icons/circle-question-regular-full.svg" alt="">
                        </button>
                        <div class="searchInputWraper">
                            <img class="searchIcon iconColor" src="${assetsPath}/img/icons/magnifying-glass-solid-full.svg" alt="">
                            <input class="searchInput" type="text" name="q" id="emptySearchInput" placeholder="Digite para buscar...">
                            <button class="searchCloseBtn" type="button" aria-label="Limpar busca">
                                <img class="iconColor" src="${assetsPath}/img/icons/xmark-solid-full.svg" alt="">
                            </button>
                            <kbd class="searchKBD">Ctrl+K</kbd>
                        </div>
                        <button class="searchBtn" type="submit">Buscar</button>
                        <button type="button" class="filterBtn">
                            <span class="filterBtnIcon">
                                <img class="iconColor" src="${assetsPath}/img/icons/filter-solid-full.svg" alt="">
                            </span>
                            <span class="filterBtnText">Filtrar</span>
                            <span class="filtersUsedNumbers" id="emptyFilterCount"></span>
                        </button>
                    </div>
                </form>
                <a href="\#" class="empty-help-link" id="emptyHelpLink">
                    <img class="iconColor" src="${assetsPath}/img/icons/circle-question-regular-full.svg" alt="">
                    <span>Ajuda</span>
                </a>
            </search>
        </div>
    </main>

    <div id="sidebarOverlay"></div>

    <!-- PAGE RESULTS -->
    <main id="pageResults">
        <aside id="sidebar">
            <div class="sidebar-header">
                <div class="header-top">
                    <div class="btn-group">
                        <button class="circle-btn btn-expand-all" title="Expandir todos">
                            <img src="${assetsPath}/img/icons/maximize-solid-full.svg" alt="Expandir" class="circle-btn-icon">
                        </button>
                        <button class="circle-btn circle-btn-right btn-collapse-all" title="Recolher todos">
                            <img src="${assetsPath}/img/icons/minimize-solid-full.svg" alt="Recolher" class="circle-btn-icon">
                        </button>
                    </div>
                    <div class="search-input-wrapper">
                        <input type="text" class="search-input facet-filter" placeholder="Filtrar facetas...">
                        <button type="button" class="clear-btn">
                            <img src="${assetsPath}/img/icons/xmark-solid-full.svg" alt="Limpar" class="clear-icon">
                        </button>
                    </div>
                </div>
            </div>
            #parse("facets.vm")
            <div id="sidebarResizer"></div>
        </aside>

        <section id="mainContent">
            #if($request.params.getParams('fq') && $request.params.getParams('fq').size() > 0)
            <header id="pageResultsHeader">
                #parse("used_filters.vm")
            </header>
            #end
            
            <section id="results">
                #parse("results_list.vm")
            </section>
            
            <footer id="pageResultsFooter">
                #parse("pagination.vm")
            </footer>
        </section>
    </main>

    <!-- DIALOGS -->
    #parse("filters_dialog.vm")
    #parse("info_dialog.vm")
    #parse("ajuda_dialog.vm")

    <!-- JS Core (ordem importa!) -->
    <script src="${assetsPath}/js/core/config.js"></script>
    <script src="${assetsPath}/js/core/utils.js"></script>
    
    <!-- JS Controllers -->
    <script src="${assetsPath}/js/controllers/PageController.js"></script>
    
    <!-- JS Components -->
    <script src="${assetsPath}/js/components/AccordionComponent.js"></script>
    <script src="${assetsPath}/js/components/AccessibilityComponent.js"></script> 
    <script src="${assetsPath}/js/components/AutocompleteComponent.js"></script>
    <script src="${assetsPath}/js/components/CurrencyInputComponent.js"></script>
    <script src="${assetsPath}/js/components/DialogComponent.js"></script>
    <script src="${assetsPath}/js/components/DropdownComponent.js"></script>
    <script src="${assetsPath}/js/components/FilterCounterComponent.js"></script>
    <script src="${assetsPath}/js/components/FilterOperatorComponent.js"></script>
    <script src="${assetsPath}/js/components/KeyboardShortcuts.js"></script>
    <script src="${assetsPath}/js/components/LiveHighlightComponent.js"></script>
    <script src="${assetsPath}/js/components/ResultCardComponent.js"></script>
    <script src="${assetsPath}/js/components/SearchComponent.js"></script>
    <script src="${assetsPath}/js/components/SidebarComponent.js"></script>
    <script src="${assetsPath}/js/facets.js"></script>
    <script src="${assetsPath}/js/fieldsSelector.js"></script>
    
    <!-- JS InicializaÃ§Ã£o (sempre por Ãºltimo) -->
    <script src="${assetsPath}/js/core/dom.js"></script>
</body>
</html>
