#**
 *  Global macros used by other templates.
 *  This file must be named VM_global_library.vm
 *#

#macro(param $key)$request.params.get($key)#end

#macro(url_root)/solr#end

#macro(core_name)$request.core.name#end
#macro(url_for_solr)#{url_root}#if($request.core.name != "")/$request.core.name#end#end
#macro(url_for_home)#url_for_solr/browse#end

#macro(q)&q=$!{esc.url($params.get('q'))}#end

#macro(fqs $p)#foreach($fq in $p)#if($velocityCount && $velocityCount>1)#{end}&fq=$esc.url($fq)#end#end

#macro(debug)#if($request.params.get('debugQuery'))&debugQuery=true#end#end

#macro(sort $p)#if($p)#foreach($s in $p)&sort=$esc.url($s)#end#end#end

#macro(lensNoQ)?#if($request.params.getParams('fq') && $request.params.getParams('fq').size() > 0)#fqs($request.params.getParams('fq'))#end#sort($request.params.getParams('sort'))#debug#end
#macro(lens)#lensNoQ#q#end

#macro(url_for_lens)#{url_for_home}#lens#end

#macro(url_for_start $start)#url_for_home#lens&start=$start#end

#macro(url_for_filters $p)#url_for_home?#q#if($p!=$null && $list.size($p) > 0)&#fqs($p)#end#debug#end

#macro(url_for_facet_filter $field $value)#url_for_home#lens&fq=#if($value!=$null)$esc.url($field):%22$esc.url($value)%22#else-$esc.url($field):[*+TO+*]#end#end

#macro(url_for_facet_date_filter $field $value)#url_for_home#lens&fq=$esc.url($field):$esc.url($value)#end

#macro(url_for_facet_range_filter $field $value)#url_for_home#lens&fq=$esc.url($field):$esc.url($value)#end

#macro(url_remove_filter $filterToRemove)
#set($newFilters = [])
#foreach($fq in $request.params.getParams('fq'))
#if($fq != $filterToRemove)
#set($dummy = $newFilters.add($fq))
#end
#end
#url_for_filters($newFilters)
#end

#macro(link_to_previous_page $text)
  #if($page.current_page_number > 1)
    #set($prev_start = $page.start - $page.results_per_page)
    <a class="pageNav" href="#url_for_start($prev_start)">$text</a>
  #end
#end

#macro(link_to_next_page $text)
  #if($page.current_page_number < $page.page_count)
    #set($next_start = $page.start + $page.results_per_page)
    <a class="pageNav" href="#url_for_start($next_start)">$text</a>
  #end
#end

#macro(link_to_page $page_number)
  #set($page_start = $page_number * $page.results_per_page - $page.results_per_page)
  #if($page_number == $page.current_page_number)
    <button class="pageNumber active">$page_number</button>
  #else
    <a class="pageNumber" href="#url_for_start($page_start)">$page_number</a>
  #end
#end

#macro(field $f)
  #if($response.response.highlighting.get($docId).get($f).get(0))
    #set($pad = "")
    #foreach($v in $response.response.highlighting.get($docId).get($f))
$pad$v##
      #set($pad = " ... ")
    #end
  #else
    #foreach($v in $doc.getFieldValues($f))
$v##
    #end
  #end
#end

#macro(format_date $dateValue)
#if($dateValue)
$date.format('dd/MM/yyyy HH:mm', $dateValue, $date.getLocale(), $date.getTimeZone().getTimeZone('America/Sao_Paulo'))##
#end
#end

#macro(format_cpf $cpf)
#if($cpf && $cpf.length() == 11)
$cpf.substring(0,3).$cpf.substring(3,6).$cpf.substring(6,9)-$cpf.substring(9,11)##
#else
$cpf##
#end
#end

#macro(format_cnpj $cnpj)
#if($cnpj && $cnpj.length() == 14)
$cnpj.substring(0,2).$cnpj.substring(2,5).$cnpj.substring(5,8)/$cnpj.substring(8,12)-$cnpj.substring(12,14)##
#else
$cnpj##
#end
#end

#macro(highlight_field $fieldName $fieldValue)
#if($response.response.highlighting && $response.response.highlighting.get($docId) && $response.response.highlighting.get($docId).get($fieldName))
#foreach($v in $response.response.highlighting.get($docId).get($fieldName))$v#end
#else
$!fieldValue
#end
#end
