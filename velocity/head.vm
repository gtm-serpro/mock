#**
 *  Head section - CSS, meta tags, fonts
 *#

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/svg+xml" href="${assetsPath}/img/favicon/logo-simbolo_e-Processo.svg">

<title>eProcesso Buscador #if($params.get('q') && $params.get('q') != '*:*')- $!esc.html($params.get('q'))#end</title>

#**
 * ========================================
 * DETEC√á√ÉO AUTOM√ÅTICA DE AMBIENTE
 * ========================================
 *#
#set($serverName = $request.serverName)
#set($requestURI = $request.requestURI)

## Detectar ambiente pela URL
#if($serverName.matches("10\\.139\\.73\\..*"))
    #set($ambiente = "dev")
    #set($ambienteLabel = "Desenvolvimento")
    #set($ambienteColor = "#ffc107")
    #set($ambienteTextColor = "#000")
#elseif($serverName.contains("receita.fazenda") && $requestURI.contains("_hml"))
    #set($ambiente = "homologacao")
    #set($ambienteLabel = "Homologa√ß√£o")
    #set($ambienteColor = "#2196f3")
    #set($ambienteTextColor = "#fff")
#elseif($serverName.contains("receita.fazenda"))
    #set($ambiente = "producao")
    #set($ambienteLabel = "Produ√ß√£o")
    #set($ambienteColor = "")
    #set($ambienteTextColor = "")
#else
    #set($ambiente = "local")
    #set($ambienteLabel = "Local")
    #set($ambienteColor = "#9c27b0")
    #set($ambienteTextColor = "#fff")
#end

## Banner visual (exceto produ√ß√£o)
#if($ambiente != "producao")
<style>
.ambiente-banner {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 99999;
    text-align: center;
    padding: 4px 8px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    background: $ambienteColor;
    color: $ambienteTextColor;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
body {
    padding-top: 28px !important;
}
</style>
<div class="ambiente-banner">
    üöß Ambiente: $ambienteLabel #if($ambiente == "dev")($serverName)#end
</div>
#end

<!-- CSS -->
<link rel="stylesheet" href="${assetsPath}/css/reset.css">
<link rel="stylesheet" href="${assetsPath}/css/variables.css">
<link rel="stylesheet" href="${assetsPath}/css/accessibility.css">
<link rel="stylesheet" href="${assetsPath}/css/typography.css">
<link rel="stylesheet" href="${assetsPath}/css/components.css">
<link rel="stylesheet" href="${assetsPath}/css/global.css">
<link rel="stylesheet" href="${assetsPath}/css/mainHeader.css">
<link rel="stylesheet" href="${assetsPath}/css/pageEmpty.css">
<link rel="stylesheet" href="${assetsPath}/css/pageResults.css">
<link rel="stylesheet" href="${assetsPath}/css/resultCard.css">
<link rel="stylesheet" href="${assetsPath}/css/dialogs.css">
<link rel="stylesheet" href="${assetsPath}/css/fieldsSelector.css">
<link rel="stylesheet" href="${assetsPath}/css/ajudaDialog.css">

<script>
// Configura√ß√£o global do Solr + Ambiente
var SOLR_CONFIG = {
    // Ambiente
    ambiente: '$ambiente',
    ambienteLabel: '$ambienteLabel',
    isDev: '$ambiente' === 'dev',
    isHomologacao: '$ambiente' === 'homologacao',
    isProducao: '$ambiente' === 'producao',
    isLocal: '$ambiente' === 'local',
    
    // URLs
    baseUrl: '#url_for_solr',
    browseUrl: '#url_for_home',
    
    // Query
    currentQuery: #if($params.get("q"))'$!esc.javascript($params.get("q"))'#else null#end,
    currentFilters: [
        #foreach($fq in $request.params.getParams('fq'))
            '$esc.javascript($fq)'#if($foreach.hasNext),#end
        #end
    ],
    
    // Pagina√ß√£o - CORRIGIDO
    resultsFound: #if($response && $response.response && $response.response.numFound)$response.response.numFound#{else}0#end,
    currentPage: #if($request.params.get('start'))$math.div($request.params.get('start'), 10) + 1#{else}1#end,
    totalPages: #if($response && $response.response && $response.response.numFound)$math.ceil($math.div($response.response.numFound, 10))#{else}0#end,
    resultsPerPage: #if($request.params.get('rows'))$request.params.get('rows')#{else}10#end
};

// Log de debug (apenas em DEV e LOCAL)
if (SOLR_CONFIG.isDev || SOLR_CONFIG.isLocal) {
    console.log('üåç Ambiente:', SOLR_CONFIG.ambiente);
    console.log('üìä Config:', SOLR_CONFIG);
    console.log('üìÑ Response:', #if($response)true#{else}false#end);
    #if($response && $response.response)
    console.log('üìä NumFound:', $response.response.numFound);
    console.log('üìÑ Docs:', #if($response.response.docs)$response.response.docs.size()#{else}0#end);
    #end
}

if (SOLR_CONFIG.isDev || SOLR_CONFIG.isHomologacao) {
    // Esconder banner ap√≥s 5 segundos
    setTimeout(function() {
        const banner = document.querySelector('.ambiente-banner');
        if (banner) {
            banner.style.transition = 'opacity 0.5s';
            banner.style.opacity = '0';
            setTimeout(() => banner.remove(), 500);
        }
    }, 5000);
}
</script>